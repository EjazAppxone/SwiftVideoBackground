osx_image: xcode9.2
language: objective-c
rvm: 2.2.2
xcode_project: SwiftVideoBackground.xcodeproj

env:
  global:
    - PROJECT=SwiftVideoBackground.xcodeproj
    - SCHEME=SwiftVideoBackground

install:
  - wget --output-document /tmp/SwiftLint.pkg https://github.com/realm/SwiftLint/releases/download/0.24.2/SwiftLint.pkg && sudo installer -pkg /tmp/SwiftLint.pkg -target /
  - gem install xcpretty
  - gem install xcpretty-json-formatter

env:
  - UDID="7A5E86EB-E32C-475F-8FF5-10AA330C1D34", IOS_DEVICE="iPhone 7 Plus (11.1)"
  - UDID="15E2107D-EAD2-4E1F-8BC3-59E58E750FB1", IOS_DEVICE="iPhone 7 (10.0)"
  - UDID="9AB3D590-C748-4E17-8E35-67B298E973F7", IOS_DEVICE="iPhone 6 Plus (9.0)"
  - UDID="80BE80F4-C243-43F0-BD95-5CB085DAD04F", IOS_DEVICE="iPhone 6 (8.1)"

script:
  - set -o pipefail

  - swiftlint

  - open -a "simulator" --args -CurrentDeviceUDID $UDID
  - xcodebuild clean test -project "$PROJECT" -scheme "$SCHEME" -configuration Debug -sdk iphonesimulator -destination "platform=iOS Simulator,id=$UDID" CODE_SIGN_IDENTITY=\"\" CODE_SIGNING_REQUIRED=NO ONLY_ACTIVE_ARCH=NO | XCPRETTY_JSON_FILE_OUTPUT="xcodebuild.json" xcpretty -f `xcpretty-json-formatter`

  - pod lib lint
  - bundle exec danger --fail-on-errors=true
